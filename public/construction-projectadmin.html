<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="Ape's Console">
    <meta name="author" content="">
    <link rel="icon" href="/resources/bootstrap/favicon.ico">

    <title>SmartCom</title>

    <!-- Bootstrap core CSS -->
    <link href="/resources/bootstrap/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">


    <!-- MetisMenu CSS -->
    <link href="/resources/bootstrap/vendor/metisMenu/metisMenu.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="/resources/bootstrap/dist/css/sb-admin-2.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="/resources/bootstrap/vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
	<style>
		.fonty {
			color: #5e5e5e;
		}
		.btn-info: {
			background-color: #5e5e5e;
		}
		.icon {
			width: 40px;
			height: 40px;
			color: green;
		}
		.odd {
		  background-color: #eee;
		  height: 10px;
		}
		.even {
		  background-color: white;
		}	
	</style>
  </head>

  <body>
    <div id="wrapper" ng-app="projectadminApp" ng-controller="projectadminCtrl">
        <!-- Navigation -->
        <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0;  background-color: #5e5e5e;">
			<div class="navbar-header">
                <a class="navbar-brand" style='color: white; font-size: 12px;' href="power">
					<strong style='font-size: 17px; font-style:italic;'>smart<strong style='font-size: 20px; font-style:italic;'>Com</strong> | </strong> <strong> Welcome</strong> : {{name}}
				</a>
            </div>
			<leftmenu></leftmenu>
		</nav>
		<div id="page-wrapper">
			<div class="row">
				<div class="col-lg-12">
					<h1 class="page-header fonty">{{action}}</h1>
					<span style="color: red;">{{message}}</span>
				</div>
			</div>
			<!-- PROJECT LIST -->
			<div class="row" ng-show="projectList">
				<div class="col-lg-12">
				  <table class="table fonty">
					<thead>
					  <tr>
						<th>Project Id</th>
						<th>Name</th>
						<th>Status</th>
						<th>Operation</th>
					  </tr>
					</thead>
					<tbody>
					  <tr ng-repeat="project in projects | orderBy : 'projectName'" ng-class-odd="'odd'" ng-class-even="'even'">
						<td>
							<span class="">{{project.projectId}}</span>
						</td>
						<td>
							<span class="">{{project.projectName}}</span>
						</td>
						<td>
							<span  ng-if="project.active" class="">Active</span>
							<span  ng-if="!project.active" class="">In-Active</span>
						</td>				
						<td>
							<button class="btn btn-xs btn-primary" type="button" ng-click="goToProjectSite(project)">
								Sites
							</button>						
							<button class="btn btn-xs btn-primary" type="button" ng-click="goToEditProject(project)">
								Edit
							</button>							
						</td>
					  </tr>		  
					</tbody>
				  </table>	
				  <button class="btn btn-xs btn-success" type="button" ng-click="goToAddProject()">
						Create New Project
				  </button>			  
				</div>
			</div>	

			
			<!-- SITE LIST -->
			<div class="row" ng-show="siteList">
				<div class="col-lg-12">
				  <table class="table fonty">
					<thead>
					  <tr>
						<th>Site Id</th>
						<th>Site Name</th>
						<th>Status</th>
						<th>Operation</th>
					  </tr>
					</thead>
					<tbody>
					  <tr ng-repeat="site in sites | orderBy : 'siteName'" ng-class-odd="'odd'" ng-class-even="'even'">
						<td>
							<span class="">{{site.siteId}}</span>
						</td>						
						<td>
							<span class="">{{site.siteName}}</span>
						</td>						
						<td>
							<span  ng-if="site.active" class="">Active</span>
							<span  ng-if="!site.active" class="">In-Active</span>
						</td>				
						<td>
							<button class="btn btn-xs btn-primary" type="button" ng-click="goToEditSite(site)">
								Edit
							</button>
						</td>
					  </tr>		  
					</tbody>
				  </table>
				  <button class="btn btn-xs btn-success" type="button" ng-click="goToAddSite()">
						Create New Site
				  </button>				  
				  <button class="btn btn-xs btn-default" type="button" ng-click="goToProjectList()">
						Back
				  </button>					  
				</div>
			</div>	

			<!-- EDIT SITE -->
			<div class="row" ng-show="editSite">
				<div class="col-sm-4 fonty">
					<form role="form" action="edituser" method="post">
						<div class="form-group">
							<label>Site Id</label>
							<input class="form-control" disabled="true" name="siteId" ng-model="site.siteId">
							<input ng-hide="true" name="siteId" ng-model="site.siteId">
							<!--<p class="help-block">Example block-level help text here.</p>-->
						</div>
						<div class="form-group">
							<label>Site Name</label>
							<input class="form-control" name="name" ng-model="site.siteName" maxlength="50">
						</div>	
						<div class="form-group">
							<label>Site Address</label>
							<textarea class="form-control" name="address" ng-model="site.address">
							</textarea>
						</div>
						<div class="form-group">
							<label>Geo Tag</label>
							<input class="form-control" name="name" ng-model="site.geoTag.lat">
							<input class="form-control" name="name" ng-model="site.geoTag.lonG">
						</div>						
						<div class="form-group">
							<label>Status</label>
							<div class="radio">
								<label>
									<input type="radio" name="active" ng-value="true" ng-model="site.active">Active
								</label>
							</div>
							<div class="radio">
								<label>
									<input type="radio" name="active" ng-value="false" ng-model="site.active">In-Active
								</label>
							</div>
						</div>						
					</form>
					<a href="#" onclick="document.forms[0].submit();" class="btn btn-xs btn-success">
						Save Site
					</a>
					<button class="btn btn-xs btn-default" type="button" ng-click="goToSiteList()">
						Cancel
					</button>					
				</div>
				<!-- EDIT ACCESS -->
				<div class="col-sm-8 fonty" ng-show="assignedList">
					<h3>Assigned Users</h3>
					<table class="table fonty">
						<thead>
						  <tr>
							<th>User Id</th>
							<th>Name</th>
							<th>Operation</th>
						  </tr>
						</thead>
						<tbody>
						  <tr ng-repeat="user in assigneduserlist" ng-class-odd="'odd'" ng-class-even="'even'">
							 <td>
								{{user.userId}}
							 </td>						  
							 <td>
								{{user.name}}
							 </td>
							 <td>
								<button class="btn btn-xs btn-primary" type="button"  ng-click="goToSiteUserAccess(user)">
									Access
								</button>
								<button class="btn btn-xs btn-danger" type="button">
									Un-Assign
								</button>									
							 </td>
						  </tr>
						</tbody>
					</table>					
				</div>	
				<div class="col-sm-8 fonty" ng-show="unassignedList">
					<h3>Un-Assigned Users</h3>
					<table class="table fonty">
						<thead>
						  <tr>
							<th>User Id</th>
							<th>Name</th>
							<th>Operation</th>
						  </tr>
						</thead>
						<tbody>
						  <tr ng-repeat="user in unassigneduserlist" ng-class-odd="'odd'" ng-class-even="'even'">
							 <td>
								{{user.userId}}
							 </td>						  
							 <td>
								{{user.name}}
							 </td>
							 <td>
								<button class="btn btn-xs btn-danger" type="button">
									Assign
								</button>									
							 </td>
						  </tr>
						</tbody>
					</table>					
				</div>	
				<div class="col-sm-8 fonty" ng-show="useraccess">
					<h3>Access Details / {{accessDetails.name}}</h3>
					<table class="table fonty">
						<thead>
						  <tr>
							<th>Action</th>
							<th>Yes</th>
							<th>No</th>
						  </tr>
						</thead>
						<tbody>
						  <tr class="odd">
							 <td>
								View Finance
							 </td>						  
							 <td>
								<input type="radio" name="viewFinance" ng-value="true"  ng-model="accessDetails.viewFinance">
							 </td>						  
							 <td>	
								<input type="radio" name="viewFinance" ng-value="false" ng-model="accessDetails.viewFinance">
							 </td>
						  </tr>
						  <tr class="even">
							 <td>
								Approve
							 </td>						  
							 <td>
								<input type="radio" name="approve" ng-value="true"  ng-model="accessDetails.approve">
							 </td>						  
							 <td>
								<input type="radio" name="approve" ng-value="false" ng-model="accessDetails.approve">
							 </td>
						  </tr>	
						  <tr  class="odd">
							 <td>
								Create Order
							 </td>						  
							 <td>
								<input type="radio" name="createOrder" ng-value="true"  ng-model="accessDetails.createOrder">
							 </td>						  
							 <td>
								<input type="radio" name="createOrder" ng-value="false" ng-model="accessDetails.createOrder">
							 </td>
						  </tr>	
						  <tr class="even">
							 <td>
								Create Bill
							 </td>						  
							 <td>
								<input type="radio" name="createBill" ng-value="true"  ng-model="accessDetails.createBill">
							 </td>						  
							 <td>
								<input type="radio" name="createBill" ng-value="false" ng-model="accessDetails.createBill">
							 </td>
						  </tr>
						  <tr  class="odd">
							 <td>
								Receive Shipment
							 </td>						  
							 <td>
								<input type="radio" name="receive" ng-value="true"  ng-model="accessDetails.receive">
							 </td>						  
							 <td>
								<input type="radio" name="receive" ng-value="false" ng-model="accessDetails.receive">
							 </td>
						  </tr>
						  <tr class="even">
							 <td>
								Make Payments
							 </td>						  
							 <td>
								<input type="radio" name="pay" ng-value="true"  ng-model="accessDetails.pay">
							 </td>						  
							 <td>
								<input type="radio" name="pay" ng-value="false" ng-model="accessDetails.pay">
							 </td>
						  </tr>						  
						</tbody>
					</table>
					<button class="btn btn-xs btn-default" type="button" ng-click="goToAssignedList(accessDetails.siteId)">
						Back
					</button>
				</div>
			</div>	
			<br/>
			<br/>
		</div>
	</div>
	<!-- Angular -->
	<script src="/resources/angular/angular.min.js"></script>
    <!-- jQuery -->
    <script src="/resources/bootstrap/vendor/jquery/jquery.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="/resources/bootstrap/vendor/bootstrap/js/bootstrap.min.js"></script>

    <!-- Metis Menu Plugin JavaScript -->
    <script src="/resources/bootstrap/vendor/metisMenu/metisMenu.min.js"></script>

    <!-- Custom Theme JavaScript -->
    <script src="/resources/bootstrap/dist/js/sb-admin-2.js"></script>
  </body>
</html>
<script>
	var projectadmin = angular.module('projectadminApp', []);
	projectadmin.directive('leftmenu', function($compile) {
		var directive = {};
		directive.restrict = 'E';
		directive.templateUrl = "/resources/templates/construction-left-menu.html";		
		directive.controller = function($scope, $rootScope, $http) {
			$scope.dasboardtab = '';		
		};		
		return directive;
	});	
	
	var projectController = function($scope, $http){
		$scope.action = 'Projects';
		$scope.projectList = true;	
		$scope.siteList = false;
		$scope.editSite = false;
		$scope.assignedList = false;
		$scope.unassignedList = false;
		$scope.useraccess = false;
		$http.get("/getprojects")
		.then(function(response) {
			$scope.projects = response.data.projects;
		});
		$scope.goToAddProject = function(){
			
		}
		$scope.goToEditProject = function(project){

		}
		$scope.goToProjectSite = function(project){
			siteController($scope, $http, project);
		}
	}
	
	var siteController = function($scope, $http, project){
		$scope.action = project.projectName + ' / Sites';
		$scope.projectList = false;	
		$scope.siteList = true;
		$scope.editSite = false;
		$scope.assignedList = false;
		$scope.unassignedList = false;
		$scope.useraccess = false;
		$http.get("/getsites?projectId=" + project.projectId)
		.then(function(response) {
			$scope.sites = response.data.sites;
		});
		$scope.goToAddSite = function(){
		
		}
		$scope.goToEditSite = function(site){
			$scope.action = project.projectName + ' / ' + site.siteName;
			$scope.site = site;
			$scope.projectList = false;	
			$scope.siteList = false;
			$scope.editSite = true;
			$scope.useraccess = false;
			$http.get("/getassignedusers?siteId=" + site.siteId)
			.then(function(response) {
				$scope.assignedList = true;
				$scope.unassignedList = true;			
				$scope.assigneduserlist = response.data.assigneduserlist;
				$scope.unassigneduserlist = response.data.unassigneduserlist;
			});			
		}
		$scope.goToSiteList = function(){
			$scope.assigneduserlist = [];
			$scope.unassigneduserlist = [];
			siteController($scope, $http, project);
		}
		$scope.goToSiteUserAccess = function(accessDetails){
			$scope.accessDetails = accessDetails;
			$scope.assignedList = false;
			$scope.unassignedList = false;
			$scope.useraccess = true;
		}
		$scope.goToAssignedList = function(siteId){
			$scope.useraccess = false;
			$http.get("/getassignedusers?siteId=" + siteId)
			.then(function(response) {
				$scope.assignedList = true;
				$scope.unassignedList = true;			
				$scope.assigneduserlist = response.data.assigneduserlist;
				$scope.unassigneduserlist = response.data.unassigneduserlist;
			});	
		}
	}
	
	projectadmin.controller('projectadminCtrl', function($scope, $http) {
		$http.get("/getuser")
		.then(function(response) {
			$scope.selectedTab = 'project-management';
			$scope.name = response.data.userData.name;
			$scope.userMenu = response.data.userMenu;
			$scope.message = '<%=message%>';
			projectController($scope, $http);
			$scope.goToProjectList = function(){
				projectController($scope, $http);
			}
		});	
	});
</script>
